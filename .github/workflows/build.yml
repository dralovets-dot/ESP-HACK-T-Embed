name: Build Project

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install PlatformIO
      run: pip install platformio
    
    - name: Create minimal files
      run: |
        # Создаем platformio.ini если нет
        if [ ! -f platformio.ini ]; then
          cat > platformio.ini << 'INI_EOF'
          [env:esp32-s3]
          platform = espressif32
          board = esp32-s3-devkitc-1
          framework = arduino
          monitor_speed = 115200
          INI_EOF
        fi
        
        # Создаем main.cpp если нет
        if [ ! -f src/main.cpp ]; then
          mkdir -p src
          cat > src/main.cpp << 'CPP_EOF'
          #include <Arduino.h>
          
          void setup() {
            Serial.begin(115200);
            delay(1000);
            Serial.println("Test Build");
          }
          
          void loop() {
            delay(1000);
          }
          CPP_EOF
        fi
    
    - name: Build with PlatformIO
      run: pio run
