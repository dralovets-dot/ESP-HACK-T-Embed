name: Build Test

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup
      run: |
        pip install platformio
        mkdir -p src
    
    - name: Create test files
      run: |
        # Простой platformio.ini
        echo "[env:test]" > platformio.ini
        echo "platform = espressif32" >> platformio.ini
        echo "board = esp32-s3-devkitc-1" >> platformio.ini
        echo "framework = arduino" >> platformio.ini
        echo "monitor_speed = 115200" >> platformio.ini
        
        # Простой main.cpp если нет
        if [ ! -f src/main.cpp ]; then
          cat > src/main.cpp << 'CPP_EOF'
          #include <Arduino.h>
          void setup() { Serial.begin(115200); Serial.println("Test"); }
          void loop() { delay(1000); }
          CPP_EOF
        fi
    
    - name: Build
      run: pio run -e test
